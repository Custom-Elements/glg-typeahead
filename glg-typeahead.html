<!-- glg-typeahead for Polymer 1.0 -->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-item/paper-item.html">

<dom-module id="glg-typeahead">
  <template>
    <paper-input
      id="search"
      value="{{searchString}}"
      label="[[label]]"
      autofocus="[[autofocus]]"
      placeholder="[[placeholder]]"
      type="text"
      on-input="_fireInputUpdated"
      no-label-float
      autocomplete="off"
    >
    </paper-input>
    <paper-menu
      id="typeaheadResults"
      style="display: none; position: absolute;"
      selected="[[selectedItem]]"
      attr-for-selected="cmId"
      on-iron-select="_fireItemSelected"
      >
      <template id="autocomplete" is="dom-repeat" items="{{results}}">
        <!-- TODO: embed the item template within the body of the glg-typeahead element -->
        <paper-item cm-id="{{item._id}}" cm-person-id="{{item._source.personId}}" name="{{item._source.name}}" job-title="{{item._source.title}}" company="{{item._source.company}}">
          <paper-item-body two-line>
            <div class="cm-name">{{item._source.name}}</div>
            <div class="cm-meta">{{item._source.title}}</div>
            <div class="cm-meta cm-company">{{item._source.company}}</div>
          </paper-item-body>
        </paper-item>
      </template>
    </paper-menu>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'glg-typeahead',
    properties: {
      autofocus: {
        type: Boolean,
        value: false
      },
      waitDuration: {
        type: Number,
        value: 0
      },
      label: {
        type: String,
        value: null
      },
      placeholder: {
        type: String,
        value: null
      },
      results: {
        type: Array,
        value: [],
        observer: '_updateResultsDisplay'
      },
      searchString: {
        type: String,
        notify: true,
        value: null
      },
      selectedItem: {
        type: String,
        value: null
      }
    },
    _fireInputUpdated: function(event) {
      this.debounce('inputChanged', function() {
          this.fire('input-updated', this.searchString);
        },this.waitDuration
      );
    },
    _fireItemSelected: function(event) {
      this.fire('item-selected', this.$.typeaheadResults.selectedItem);
      this.$.search.value = this.$.typeaheadResults.selectedItem.name;
      this.$.typeaheadResults.style.display = 'none';
    },
    _updateResultsDisplay: function(newResults, oldResults) {
      if (newResults.length <= 0) {
        this.$.typeaheadResults.style.display = 'none';
      } else {
        this.$.typeaheadResults.style.display = null;
      }
    }
  });
</script>
